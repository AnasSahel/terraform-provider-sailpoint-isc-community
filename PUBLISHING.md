# Publishing Guide - Terraform Provider SailPoint ISC Community

This document outlines the steps to publish the provider to the Terraform Registry.

## Prerequisites

- [x] GitHub repository is public
- [x] Provider follows [Terraform Registry requirements](https://developer.hashicorp.com/terraform/registry/providers/publishing)
- [x] GoReleaser configuration (`.goreleaser.yml`) is present
- [x] Terraform Registry manifest (`terraform-registry-manifest.json`) is present
- [x] GPG key for signing releases
- [x] GitHub Actions workflow for releases (optional but recommended)

## Current Release Status

**Version:** v0.3.0
**Tag Created:** ✅ v0.3.0
**Commit:** ce39e5b - "chore: Prepare release v0.3.0"

## Publishing Steps

### 1. Push to GitHub

Push the commits and tags to GitHub:

```bash
# Push commits
git push origin main

# Push tags
git push origin v0.3.0
```

### 2. Create GitHub Release

Using the GitHub CLI (if installed):

```bash
gh release create v0.3.0 \
  --title "Release v0.3.0 - Transform Resource Management" \
  --notes-file .github/RELEASE_NOTES_v0.3.0.md
```

Or manually via GitHub UI:
1. Go to https://github.com/AnasSahel/terraform-provider-sailpoint-isc-community/releases/new
2. Select tag: `v0.3.0`
3. Set title: "Release v0.3.0 - Transform Resource Management"
4. Copy content from `.github/RELEASE_NOTES_v0.3.0.md` into description
5. Click "Publish release"

### 3. Run GoReleaser (Automated via GitHub Actions)

If you have GitHub Actions set up with GoReleaser, the release will be built automatically.

**Manual GoReleaser (if needed):**

```bash
# Set GPG fingerprint
export GPG_FINGERPRINT=<your-gpg-fingerprint>

# Run goreleaser
goreleaser release --clean
```

### 4. Verify Release Assets

After GoReleaser completes, verify the release includes:

- [x] Binaries for all platforms (darwin, linux, windows)
- [x] Binaries for all architectures (amd64, 386, arm, arm64)
- [x] SHA256 checksums file
- [x] GPG signature file (`.sig`)
- [x] Terraform Registry manifest JSON

### 5. Register with Terraform Registry

1. **Sign in** to the [Terraform Registry](https://registry.terraform.io/)
2. **Click "Publish"** → "Provider"
3. **Select repository**: `AnasSahel/terraform-provider-sailpoint-isc-community`
4. **Grant permissions** for Terraform Registry GitHub App
5. **Verify** provider configuration and documentation

The registry will automatically:
- Detect releases via GitHub tags
- Download release assets
- Verify GPG signatures
- Generate documentation from `docs/` directory
- Publish the provider

### 6. Verify Publication

Once published, verify at:
```
https://registry.terraform.io/providers/AnasSahel/sailpoint-isc-community/latest
```

Test installation:
```hcl
terraform {
  required_providers {
    sailpoint = {
      source  = "AnasSahel/sailpoint-isc-community"
      version = "~> 0.3.0"
    }
  }
}
```

## GitHub Actions Workflow (Recommended)

Create `.github/workflows/release.yml`:

```yaml
name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  goreleaser:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version-file: 'go.mod'
          cache: true

      - name: Import GPG key
        uses: crazy-max/ghaction-import-gpg@v6
        id: import_gpg
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.PASSPHRASE }}

      - name: Run GoReleaser
        uses: goreleaser/goreleaser-action@v5
        with:
          version: latest
          args: release --clean
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GPG_FINGERPRINT: ${{ steps.import_gpg.outputs.fingerprint }}
```

### Setting up GPG Signing

1. **Generate GPG key** (if you don't have one):
   ```bash
   gpg --full-generate-key
   ```

2. **Export GPG key**:
   ```bash
   gpg --armor --export-secret-keys <key-id>
   ```

3. **Add to GitHub Secrets**:
   - `GPG_PRIVATE_KEY`: The exported private key
   - `PASSPHRASE`: Your GPG key passphrase

4. **Upload public key** to:
   - https://keys.openpgp.org/
   - https://keyserver.ubuntu.com/

## Documentation Structure

Ensure documentation follows Terraform Registry standards:

```
docs/
├── index.md                           # Provider documentation
├── data-sources/
│   └── transform.md                   # Data source documentation
└── resources/
    └── transform.md                   # Resource documentation
```

Documentation is auto-generated by:
```bash
make generate
```

## Checklist for Each Release

- [ ] Update version in README.md
- [ ] Update version in examples/QUICKSTART.md
- [ ] Update CHANGELOG.md with release notes
- [ ] Run `make generate` to update documentation
- [ ] Commit all changes
- [ ] Create annotated git tag (e.g., `v0.3.0`)
- [ ] Push commits and tags to GitHub
- [ ] Create GitHub release with release notes
- [ ] Verify GoReleaser builds successfully
- [ ] Verify Terraform Registry updates
- [ ] Test provider installation from registry
- [ ] Announce release (optional)

## Troubleshooting

### GoReleaser Fails

- Verify `.goreleaser.yml` configuration
- Check GPG_FINGERPRINT environment variable
- Ensure all commits are pushed

### Registry Not Updating

- Verify webhook is configured
- Check release assets are properly formatted
- Ensure GPG signature is valid
- Review Terraform Registry provider page for errors

### Documentation Issues

- Run `make generate` to regenerate docs
- Verify `docs/` directory structure
- Check for markdown syntax errors

## Version Strategy

We follow [Semantic Versioning](https://semver.org/):

- **MAJOR** (x.0.0): Breaking changes
- **MINOR** (0.x.0): New features, backward compatible
- **PATCH** (0.0.x): Bug fixes, backward compatible

## Support

For questions about publishing:
- Terraform Registry Docs: https://developer.hashicorp.com/terraform/registry/providers/publishing
- GoReleaser Docs: https://goreleaser.com/
- GitHub Actions Docs: https://docs.github.com/actions
